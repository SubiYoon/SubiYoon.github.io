---
tags:
  - HTTP완벽가이드
---

# 다이제스트 인증
- 다이제스트 인증은 기본인증과 호환되는 더 안전한 대체재로서 개발되었다.
- 널리 쓰이지는 않지만, 해당 개념은 보안 트랜잭션을 구현하고자 하는 이들에게 여전히 유용하다.
    - 현재는 잘 사용되어지고 있지는 않다.

### 다이제스트 인증의 특징

- 기본인증과 달리 해당 정보를 평문으로 보내지 않는다.
- 인증 체결을 가로채서 재현하려는 행위를 차단한다.
- 구현하기에 따라 메시지 내용의 위조를 막는 것도 가능하다.
- 몇몇 알려진 공격들에 대해 방어한다.

### 비밀번호를 안전하게 지키기위해 요약 사용하기

- 다이제스트 인증은 비밀번호를 절대 네트워크를 통해 보내지 않는다.
- 서버와 클라이언트 모두 비밀번호를 가지고 있고, 해당 비밀번호의 요약문을 전송한다.
    - 이 때, 세상에 모든 비밀번호를 시도해보지 않는이상 원래 비밀번호를 알기 힘들다.
- **동작원리**
    - 클라이언트는 서버에 해당 데이터에 대한 요청을 보낸다.
    - 서버는 인증이 완료되기까지 문서 제공을 거부하고 클라이언트에 인증을 요구한다.
    - 클라이언트는 이름과 비밀번호를 입력하고 이를 요약 후 서버에게 보낸다.
    - 모든 사용자를 알고있는 서버는 받아온 요약과 서버가 가지고 있는 요약로직을 사용해 비교한다.
    - 인증이 완료되면 해당 문서를 클라이언트에게 보내준다.
 
### 단방향 요약

- 요약함수는 보통 **암호 체크섬(crptographic checksums)**으로 불린다.
	- 단방향 해시 함수
	- 지문 함수(fingerprint function)
- 일반적으로 입력 가능한 무한 가지의 모든 입력값들을 유한한 범위의 압축으로 변환한다.

### 재전송 방지를 위한 난스(nonce) 사용
- 단방향 요약은 비밀번호를 사용하지 않지만, 요약 자체가 비밀번호라고 해도 무방하다. 때문에 비밀번호를 모른다고 하더라도 요약을 가로채 서버로 몇번이고 전송 할 수 있다. 이러한 재전송 공격을 방지하기 위해 서버는 **난스(nonce)**라고하는 자주 변경(대략 1ms마다 or 인증할 때마다)되는 증표를 건네준다.
- **난스(nonce)**를 비밀번호에 섞으면 난스 변경시 요약도 변경되는데 이로 인해 재전송 공격을 막아주게 된다.

### 다이제스트 인증 핸드셰이크
- 기존 헤더에 몇몇 새 옵션이 추가되었고, 선택 적인 헤더인 **Authorization-Info**가 추가 되었다.
- **1단계**
	- 서버는 난스 값을 계산
- **2단계**
	- 서버는 난스를 **WWW-Authenticate** 인증 요구 메시지에 담아 서버가 지원하는 알고리즘 목록과 함께 클라이언트에 전송한다.
- **3단계**
	- 클라이언트는 알고리즘을 선택하고 비밀번호와 그 외 데이터에 대한 요약을 계산한다.
- **4단계**
	- 클라이언트는 **Authorization** 메시지에 요약을 담아 서버에게 보낸다.
	- 만약, 클라이언트가 서버를 인증하길 원한다면 클라이언트 **난스(nonce)**를 보낼 수 있다.
- **5단계**
	- 서버는 요약, 선택한 알고리즘, 그 외 보조 데이터를 받고 클라이언트가 했던 방식으로 요약을 진행한다.
	- 서버는 자신이 요약한 결과와 클라이언트가 보낸 요약을 비교해 일치하는지 확인한다.
	- 서버는 클라이언트가 미리 다음번 요약을 올바르게 생성할 수 있도록 다음번 난스를 미리 계산해서 클라이언트에게 넘겨줄 수도 있다.
