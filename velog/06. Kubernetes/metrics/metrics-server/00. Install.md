---
tags:
  - Kubernetes
  - Metrics
  - Install
---
## Install
```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

## TroubleShooting
#### 각 노드에 접속시 권한에 관한 문제가 있을 경우
1. `--kubelet-insecure-tls`옵션이 누락되어 https인증을 받아야하는 상황
    - https인증 없이 접속 가능하도록 수정
```bash
# 기본 셋팅
kubectl -n kube-system patch deployment metrics-server \
  --type='json' \
  -p='[{"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--kubelet-insecure-tls"}]'
  
## 함께 추가하면 더 좋음
kubectl -n kube-system patch deployment metrics-server \
  --type='json' \
  -p='[
    {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--kubelet-insecure-tls"},
    {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP"}
  ]'
```

```bash
# pod 재시작
kubectl rollout restart deployment metrics-server -n kube-system
```