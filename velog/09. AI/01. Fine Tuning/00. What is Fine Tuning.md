---
tags:
  - AI
  - FineTuning
---
## Fine Tuning??
특정 작업이나 도메인에 높은 적합성을 확보하기 위해, 이미 훈련된 대규모 언어 모델에 특정 데이터셋을 사용하여 추가적인 학습을 수행하는 작업입니다.

### 필요성
범용 LLM은 `의료분야`에는 환자의 질문에 효과적으로 대답 할 수 없다. 예컨데 "타이레놀과 감기약을 함께 복용해도 되는가?"에 대한 질문에 정확한 답을 제공하려한다면 해당 도메인에 대한 특정 내용을 적응(학습)시켜야 하기 때문입니다.

## Fine Tuning 방법
### Full Fine Tuning
모든 모델 매개변수를 포함하여 사전 학습된 모델 전체를 파인튜닝하는 작업을 의미합니다.
사전 학습된 모델과 사용하고자 하는 작업에 있어 큰 차이가 있거나 모델의 유연성과 적응성이 높아야 하는 경우 사용합니다.
상당한 리소스와 시간이 필요하지만, 그 만큼 더 좋은 성능을 얻을 수 있습니다.

### Repurposing
사전 학습된 모델의 하위 레이러를 그대로 유지한채로 모델의 상위 레이어 또는 선택된 몇개의 레이어를 파인튜닝하는 것을 의미합니다.
이 방법은 사전 학습된 모델과 사용하고자 하는 작업에 있어 유사성이 있거나 적업 데이터셋이 작은 경우에 적합한 경우가 많습니다.
`Full Fine Tuning`에 비해 필요한 리소스와 시간이 적지만, 경우에 따라 약간의 성능 저하가 발생할 수 있습니다.

### Full Fine Tuning vs Repurposing
1. `Full Find Tuning` : 작업과 사전 학습된 모델 사이에 큰 차이가 있거나 높은 적응성이 필요한 경우
2. `Repurposing` : 작업이 사전 학습된 모델과 유사성이 높거나 리소스가 제한적인 경우

## Fine Tuning의 한계
1. 데이터 품질과 양
    - 파인튜닝의 퍼포먼스는 데이터의 품질과 양에 크게 의존합니다.
      데이터의 품질이 떨어지면 과적합(OverFitting)될 가능성이 있으며, 제대로 라벨링 되지 않은 데이터를 사용하거나 편향된 데이터로 학습하면 모델이 잘못된 패턴을 학습할 수도 있습니다.
2. 높은 비용
    - 고성능 GPU와 대용량의 메모리가 요구됩니다.
      이 것은 학습 비용에 따른 학습 시간이 좌우 될 수 있음을 나타냅니다.
3. 지식 소설(Catastrophic Forgetting)
    - 파인튜닝시 기존에 사전 학습된 모델이 갖고 있던 일반적인 지식을 잃어버릴 수 있습니다.
      따라서, 기존 지식을 유지하면서 새로운 정보를 학습하는 기법이 필요하니다.
4. 일반화의 어려움
    - 모델이 특정 도메인에 과하게 최적화 되면 범용성이 떨어질 수 있습니다.

이러한 한계를 극복하기 위해 `RAG(Retrieval-Augmented Generation)`이 활용되고 있습니다.
또한, 프로프트 `엔지니어링(Prompt Engineering)`은 기특정 작업이나 도메인에 높은 정합성을 확보하기 위해, 이미 훈련된 대규모 언어 모델에 특정 데이터셋을 사용하여 추가적인 학습을 수행하는 작업으로 파인튜닝의 한계를 보충하고 있습니다.

## Fine Tuning Process
LLM의 파인튜닝 방법에는 여러가지가 있으며, 각 방법마다 `미세 조정 프로세스`, `접근 방식`, `준비 및 주기`가 다를 수 있습니다.
하지만, 대부분 파인튜닝 프로세스에는 다음과 같은 주요 단계가 포함되며, 이에 따른 준비가 필요합니다.

1. 데이터셋 준비
    - 품질과 정확성을 보장하고 필요한 데이터 정리 및 전처리를 수행합니다.
2. 사전 학습 및 파운데이션 모델 선택
    - 대상 작업의 성격과 데이터셋의 특성을 기반으로 적합한 사전 학습 모델을 선택합니다.
3. 파인튜닝 전략 정의
    - 작업 요구 사항 및 사용 가능한 리소스를 기반으로 적절한 파인튜닝 전략을 선택합니다.
    - 전체 or 부분 수행 여부와 파인튜닝 수준 및 범위를 고려합니다.
4. 하이퍼파라미터 설정
    - 학습률, 배치 크기, 훈련 에포크 수 등과 같은 파인튜닝 프로세스를 위한 하이퍼파라미터를 결정합니다.
    - 하이퍼파라미터의 선택은 미세 조정의 선능과 수렴 속도에 상당한 영향을 미칠 수 있습니다.
5. 모델 매개변수 초기화
    - 사전 학습된 모델의 가중치를 기반으로 파인튜닝된 모델의 매개변수를 초기화합니다.
    - 완전한 파인튜닝을 위해 모든 모델 매개변수가 무작위로 초기화됩니다.
    - 부분 파인튜닝의 경우 최상위 레이어 또는 일부 레이어의 매개변수만 무작위로 초기화됩니다.
6. 파인튜닝 학습
    - 준비한 데이터셋과 파인튜닝 전략을 사용하여 모델을 훈련합니다.
7. 모델 평가 및 튜닝
    - 학습 과정에서 검증 세트를 사용하여 주기적으로 모델을 평가하고 평가 결과에 따라 하이퍼파라미터를 조정하거나 전략을 미세 조정합니다.
    - 모델의 성능과 일반화 능력을 향상하는 데 도움이 됩니다.
8. 모델 성능 테스트
    - 파인튜닝이 완료된 후 테스트 세트를 사용하여 최종 파인튜닝 모델을 평가하여 성능 지표를 얻습니다.
    - 실제 적용에서 모델의 성능을 평가하는 데 도움이 됩니다.
9. 모델 배포 및 적용
    - 파인튜닝된 모델을 실제 응용 프로그램에 배포하고 실제 요구 사항을 충족하기 위해 추가 최적화 및 조정을 수행합니다.